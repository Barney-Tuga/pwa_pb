<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gest√£o ‚Äî PWA Modern</title>

  <!-- Fonte moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè≠</text></svg>">

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Login screen (shown before entering the app) -->
  <div id="login-screen" class="login-screen">
    <div class="login-card">
      <h2>Entrar</h2>
      <form id="login-form">
        <label for="login-username">Utilizador</label>
        <input id="login-username" name="username" type="text" autocomplete="username" required />
        <label for="login-password"><br>Palavra-passe</label>
        <input id="login-password" name="password" type="password" autocomplete="current-password" required />
        <div class="login-actions">
          <button type="submit" class="btn-accent">Entrar</button>
        </div>
        <div id="login-error" class="login-error" aria-live="polite"></div>
      </form>
    </div>
  </div>
  <header class="topbar">
    <div class="top-left">
      <div class="file-buttons topbar-buttons">
        <button class="file-btn" data-name="POS" data-icon="üí≥"><span class="icon">üí≥</span><span class="label">POS</span></button>
        <button class="file-btn" data-name="Clientes" data-icon="üë•"><span class="icon">üë•</span><span class="label">Clientes</span></button>
  <button class="file-btn" data-name="Vendas" data-icon="üßæ"><span class="icon">üßæ</span><span class="label">Vendas</span></button>
  <button class="file-btn" data-name="Compras" data-icon="üõí"><span class="icon">üõí</span><span class="label">Compras</span></button>
  <button class="file-btn" data-name="Guias" data-icon="üì¶"><span class="icon">üì¶</span><span class="label">Guias</span></button>
        <button class="file-btn" data-name="Or√ßamentos" data-icon="üìä"><span class="icon">üìä</span><span class="label">Or√ßamentos</span></button>
        <button class="file-btn" data-name="Fornecedores" data-icon="üè∑Ô∏è"><span class="icon">üè∑Ô∏è</span><span class="label">Fornecedores</span></button>
        <button class="file-btn" data-name="Artigos" data-icon="üì¶"><span class="icon">üì¶</span><span class="label">Artigos</span></button>
      </div>
    </div>
    <div class="top-right">
  <button id="menu-config" class="icon-btn" title="Defini√ß√µes">‚öôÔ∏è</button>
  <button class="icon-btn" title="Notifica√ß√µes">üîî</button>
  <button id="menu-profile" class="icon-btn" title="Perfil">üë§</button>
    </div>
  </header>

  <main class="app-frame">
    <aside class="left-column" id="left-column">
      <div class="left-header">
        <h4>Ferramentas</h4>
      </div>
      <ul id="tools-list" class="tools-list"></ul>
      <div class="left-footer">
        <div class="left-progress-container">
          <div class="left-progress-info">
            <small>Sistema ‚Ä¢ Carregado</small>
            <span id="left-progress-text">100%</span>
          </div>
          <div class="left-progress">
            <div class="left-progress-fill" id="left-progress-fill"></div>
          </div>
        </div>
      </div>
    </aside>

    <section class="center-column">
      <!-- Right column moved here and converted to a div (replaces previous #workspace) -->
      <div class="right-column" id="right-column-as-div">
        <div class="tabs">
          <!-- add Dashboard tab as default -->
          <button class="tab active" data-target="panel-dashboard" data-name="Dashboard" data-icon="üìä"><span class="icon">üìä</span><span class="label">Dashboard</span></button>
          <!-- tabs recreated from file-buttons (excluding POS) -->
          <button class="tab" data-target="table-clientes" data-name="Clientes" data-icon="üë•"><span class="icon">üë•</span><span class="label">Clientes</span></button>
          <button class="tab" data-target="table-vendas" data-name="Vendas" data-icon="üßæ"><span class="icon">üßæ</span><span class="label">Vendas</span></button>
          <button class="tab" data-target="table-compras" data-name="Compras" data-icon="üõí"><span class="icon">üõí</span><span class="label">Compras</span></button>
          <button class="tab" data-target="table-guias" data-name="Guias" data-icon="üì¶"><span class="icon">üì¶</span><span class="label">Guias</span></button>
          <button class="tab" data-target="table-orcamentos" data-name="Or√ßamentos" data-icon="üìä"><span class="icon">üìä</span><span class="label">Or√ßamentos</span></button>
          <button class="tab" data-target="table-fornecedores" data-name="Fornecedores" data-icon="üè∑Ô∏è"><span class="icon">üè∑Ô∏è</span><span class="label">Fornecedores</span></button>
          <button class="tab" data-target="table-artigos" data-name="Artigos" data-icon="üì¶"><span class="icon">üì¶</span><span class="label">Artigos</span></button>
        </div>
        <div id="tables-area" class="tables-area">
          <div class="tables-toolbar">
            <div class="tables-filter">
              <select id="tables-filter-select">
                <option value="any">Qualquer</option>
                <option value="id">ID / SKU</option>
                <option value="cliente">Cliente / Fornecedor</option>
                <option value="data">Data</option>
              </select>
              <input id="tables-search" type="search" placeholder="Pesquisar..." />
            </div>
          </div>

          <div id="table-clientes" class="data-panel">
            <table>
              <thead><tr><th>ID</th><th>Nome</th><th>Contacto</th><th>Email</th></tr></thead>
              <tbody>
                <tr><td>1001</td><td>Jo√£o Silva</td><td>912345678</td><td>joao@example.com</td></tr>
                <tr><td>1002</td><td>Maria Costa</td><td>911234567</td><td>maria@example.com</td></tr>
              </tbody>
            </table>
          </div>

          <!-- Dashboard panel -->
          <div id="panel-dashboard" class="data-panel">
            <div class="dashboard-hero">
              <h1>Bem-vindo de volta, Jo√£o!</h1>
              <p>Aqui est√° um resumo das suas atividades recentes</p>
            </div>
            <div class="dashboard-cards">
              <div class="card metric">
                <div class="card-icon">üßæ</div>
                <div class="card-body">
                  <div class="metric-value">24</div>
                  <div class="metric-label">Faturas este m√™s</div>
                </div>
              </div>
              <div class="card metric">
                <div class="card-icon">üõí</div>
                <div class="card-body">
                  <div class="metric-value">18</div>
                  <div class="metric-label">Compras realizadas</div>
                </div>
              </div>
              <div class="card metric">
                <div class="card-icon">üì¶</div>
                <div class="card-body">
                  <div class="metric-value">156</div>
                  <div class="metric-label">Artigos em stock</div>
                </div>
              </div>
              <div class="card metric">
                <div class="card-icon">üí∂</div>
                <div class="card-body">
                  <div class="metric-value">12.540‚Ç¨</div>
                  <div class="metric-label">Receita mensal</div>
                </div>
              </div>
            </div>
          </div>

          <div id="table-vendas" class="data-panel hidden">
            <table>
              <thead><tr><th>N¬∫</th><th>Cliente</th><th>Data</th><th>Total</th></tr></thead>
              <tbody>
                <tr><td>3001</td><td>Loja X</td><td>2025-10-02</td><td>512,00</td></tr>
                <tr><td>3002</td><td>Cliente Y</td><td>2025-10-08</td><td>120,00</td></tr>
              </tbody>
            </table>
          </div>

          <div id="table-compras" class="data-panel hidden">
            <table>
              <thead><tr><th>ID</th><th>Fornecedor</th><th>Data</th><th>Total</th></tr></thead>
              <tbody>
                <tr><td>2001</td><td>Jo√£o & Filhos</td><td>2025-10-07</td><td>291,07</td></tr>
                <tr><td>1999</td><td>DPD Portugal</td><td>2025-10-03</td><td>56,83</td></tr>
              </tbody>
            </table>
          </div>

          <div id="table-guias" class="data-panel hidden">
            <table>
              <thead><tr><th>ID</th><th>Destino</th><th>Data</th><th>Status</th></tr></thead>
              <tbody>
                <tr><td>G100</td><td>Armaz√©m A</td><td>2025-09-30</td><td>Enviado</td></tr>
              </tbody>
            </table>
          </div>

          <div id="table-orcamentos" class="data-panel hidden">
            <table>
              <thead><tr><th>ID</th><th>Cliente</th><th>Data</th><th>Total</th></tr></thead>
              <tbody>
                <tr><td>Q500</td><td>Cliente Z</td><td>2025-10-01</td><td>1200,00</td></tr>
              </tbody>
            </table>
          </div>

          <div id="table-fornecedores" class="data-panel hidden">
            <table>
              <thead><tr><th>ID</th><th>Nome</th><th>Contacto</th></tr></thead>
              <tbody>
                <tr><td>F200</td><td>DPD Portugal</td><td>213000000</td></tr>
              </tbody>
            </table>
          </div>

                    <div id="table-artigos" class="data-panel hidden">
            <table>
              <thead><tr><th>SKU</th><th>Descri√ß√£o</th><th>Stock</th><th>Pre√ßo</th></tr></thead>
              <tbody>
                <tr><td>A100</td><td>Parafuso 4mm</td><td>124</td><td>0,05</td></tr>
                <tr><td>A200</td><td>Lubrificante</td><td>42</td><td>2,50</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="bottom-bar">
    <div class="taskbar-scroll-indicator left" id="taskbar-left-indicator"></div>
    <div class="taskbar-scroll-indicator right" id="taskbar-right-indicator"></div>
    <div id="taskbar" class="taskbar" aria-live="polite"></div>
  </footer>

  <!-- Global window container: holds floating windows over the entire viewport -->
  <div id="window-container" class="window-container" aria-hidden="false"></div>

  <!-- Modal Defini√ß√µes / Edit Tools -->
  <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-overlay"></div>
    <div class="modal-window" role="document" aria-labelledby="settings-title">
      <header class="modal-header" style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid rgba(0,0,0,0.04)">
        <h3 id="settings-title" style="margin:0;font-size:16px">Defini√ß√µes</h3>
        <button id="close-settings" class="icon-btn">‚úï</button>
      </header>

      <div class="modal-inner">
        <nav class="modal-menu" aria-label="Menu de Defini√ß√µes">
          <h3 style="margin:0 0 12px 0; font-size:13px;color:var(--muted)">Defini√ß√µes</h3>
          <ul>
            <li class="active" data-target="settings-geral" onclick="window.changeSettingsTab && window.changeSettingsTab(this,'settings-geral')">Geral</li>
            <li data-target="settings-ferramentas" onclick="window.changeSettingsTab && window.changeSettingsTab(this,'settings-ferramentas')">Ferramentas</li>
            <li data-target="settings-aparencia" onclick="window.changeSettingsTab && window.changeSettingsTab(this,'settings-aparencia')">Apar√™ncia</li>
            <li data-target="settings-marcas" onclick="window.changeSettingsTab && window.changeSettingsTab(this,'settings-marcas')">Marcas</li>
            <li data-target="settings-sobre" onclick="window.changeSettingsTab && window.changeSettingsTab(this,'settings-sobre')">Sobre</li>
          </ul>
        </nav>

        <section class="modal-body">
          <div id="settings-geral" class="modal-section">
            <h4>Geral</h4>
            <p>Op√ß√µes gerais da aplica√ß√£o.</p>
          </div>

          <div id="settings-ferramentas" class="modal-section hidden">
            <h4>Ferramentas</h4>
            <label>Ferramentas (v√≠rgula separado)</label>
            <input id="tools-input" type="text" placeholder="Factura√ß√£o,Compras,Clientes" />
          </div>

          <div id="settings-aparencia" class="modal-section hidden">
            <h4>Apar√™ncia</h4>
            <p>Escolha tema, cores e modo.</p>
            <div style="display:flex;gap:12px;margin-top:12px;align-items:center">
              <button class="theme-swatch" data-color="#2563eb" title="Azul" style="background:#2563eb"></button>
              <button class="theme-swatch" data-color="#10b981" title="Verde" style="background:#10b981"></button>
              <button class="theme-swatch" data-color="#ef4444" title="Vermelho" style="background:#ef4444"></button>
              <button class="theme-swatch" data-color="#f59e0b" title="Amarelo" style="background:#f59e0b"></button>
              <button class="theme-swatch" data-color="#f97316" title="Laranja" style="background:#f97316"></button>
              <button class="theme-swatch" data-color="#8b5cf6" title="Roxo" style="background:#8b5cf6"></button>
              <button class="theme-swatch" data-color="#ec4899" title="Rosa" style="background:#ec4899"></button>
            </div>
            <div style="margin-top:10px;">
              <label style="display:flex;gap:8px;align-items:center"><input id="app-dark-mode-toggle" type="checkbox" /> Modo escuro</label>
            </div>
          </div>

          <div id="settings-marcas" class="modal-section hidden">
            <h4>Marcas e Modelos</h4>
            <div style="display:flex;gap:18px;align-items:flex-start">
              <!-- Left: marcas list -->
              <div style="width:220px;background:white;border:1px solid #eef2ff;border-radius:6px;padding:10px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                  <strong>Marcas</strong>
                  <button id="brand-add-btn" class="btn" style="font-size:12px;padding:4px 8px">+ Adicionar</button>
                </div>
                <ul id="brands-list" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px;color:#0f1724"></ul>
              </div>

              <!-- Middle: brand details -->
              <div style="flex:1;background:transparent;">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:20px;">
                  <div style="flex:1;display:flex;align-items:center;gap:8px;">
                    <div style="flex:1;min-width:0">
                      <label style="display:block;font-weight:700;margin-bottom:6px">Marca</label>
                      <input id="brand-name-input" type="text" placeholder="Nome da marca" style="width:100%;padding:10px;border:1px solid #e6eef8;border-radius:6px;font-size:14px;margin:0" />
                    </div>
                    <button id="brand-delete-btn" title="Remover marca" style="background:#fff;border:1px solid #f1f5f9;color:#ef4444;padding:8px 10px;border-radius:6px;height:40px;align-self:flex-start;margin-top:22px;">üóëÔ∏è</button>
                  </div>
                </div>

                <div style="display:flex;gap:20px;margin-top:6px">
                  <div style="flex:1;">
                    <h5 style="margin:0 0 10px 0;color:#0f1724">Foto da Marca</h5>
                    <div id="brand-photo-preview" style="height:120px;border:2px dashed #e6eef8;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#94a3b8;background-repeat:no-repeat;background-position:center;background-size:contain">Sem imagem</div>
                    <div style="margin-top:8px;">
                      <input id="brand-photo-input" type="file" accept="image/*" />
                    </div>
                  </div>

                  <!-- Right column: modelos -->
                  <div style="width:320px;">
                    <h5 style="margin:0 0 10px 0;color:#0f1724">Modelos</h5>
                    <div id="brand-models-list" style="display:flex;flex-direction:column;gap:8px"></div>
                    <div style="margin-top:12px">
                      <button id="brand-add-model" class="btn-accent">Adicionar Modelo</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="settings-sobre" class="modal-section hidden">
            <h4>Sobre</h4>
            <p>Informa√ß√£o sobre a aplica√ß√£o.</p>
          </div>

          <div class="modal-actions" style="margin-top:auto">
            <div style="flex:1"></div>
            <button id="settings-save" class="btn-primary">Guardar</button>
            <button id="settings-close" class="btn">Fechar</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    window.PUBLIC_API_URL = 'http://localhost:3000/api';
  </script>
      <!-- Model Edit Modal (nested, redesigned to match new spec) -->
      <div id="model-edit-modal" class="nested-modal hidden" role="dialog" aria-modal="true">
        <div class="modal-card modal-model-edit" style="max-width:560px;margin:40px auto;padding:18px;">
          <header class="modal-header" style="display:flex;align-items:center;justify-content:space-between;padding:6px 0 8px 0">
            <h3 style="margin:0;font-size:16px">Editar Modelo</h3>
            <button id="model-edit-close" class="icon-btn">‚úï</button>
          </header>

          <div class="modal-body" style="padding-top:6px;">
            <div class="model-edit-grid" style="display:flex;gap:16px;align-items:flex-start;">
              <div class="model-edit-form" style="flex:1;min-width:0">
                <label style="font-weight:600;display:block;margin-bottom:6px">Nome</label>
                <input id="model-edit-name" type="text" style="width:100%;padding:10px;border:1px solid #e6eef8;border-radius:8px;margin-bottom:10px" />

                <label style="font-weight:600;display:block;margin-bottom:6px">Descri√ß√£o</label>
                <textarea id="model-edit-desc" rows="4" style="width:100%;padding:10px;border:1px solid #e6eef8;border-radius:8px;margin-bottom:10px"></textarea>

                <div style="display:flex;gap:10px;align-items:center;margin-top:6px">
                  <input id="model-edit-file" type="file" accept="image/*" />
                  <div class="file-hint" style="color:#94a3b8;font-size:12px">Sem imagem</div>
                </div>
              </div>

              <div class="model-edit-image" style="width:160px;text-align:center;flex-shrink:0">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                  <div style="font-weight:600;color:#0f1724">Imagem</div>
                </div>
                <div id="model-edit-preview" class="image-preview" style="width:140px;height:120px;border:1px solid #edf2f7;border-radius:8px;background-repeat:no-repeat;background-position:center;background-size:contain;display:flex;align-items:center;justify-content:center;color:#94a3b8;margin:0 auto">Sem imagem</div>

                <div class="image-controls" style="display:flex;gap:8px;justify-content:center;margin-top:10px">
                  <button id="model-image-add" class="icon-square" title="Adicionar imagem" style="width:36px;height:36px;border-radius:8px;border:1px solid #e6eef8;background:#fff;cursor:pointer">+</button>
                  <button id="model-image-remove" class="icon-square" title="Remover imagem" style="width:36px;height:36px;border-radius:8px;border:1px solid #e6eef8;background:#fff;cursor:pointer">-</button>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-actions model-edit-actions" style="display:flex;justify-content:center;gap:12px;margin-top:16px">
            <button id="model-edit-cancel" class="btn" style="padding:10px 18px;border-radius:20px">Cancelar</button>
            <button id="model-edit-remove" class="btn" style="padding:10px 18px;border-radius:20px;color:#ef4444;border:1px solid transparent;background:transparent">Remover</button>
            <button id="model-edit-save" class="btn-primary" style="padding:10px 18px;border-radius:20px">Guardar</button>
          </div>
        </div>
      </div>
  <script>
    // lightweight api client for PWA context
    (function(){
      const API_URL = window.PUBLIC_API_URL;
      class Api {
        constructor(){ try{ this.t = localStorage.getItem('access_token'); this.r = localStorage.getItem('refresh_token'); }catch(_){}}
        async req(ep, opts={}){ const h=Object.assign({'Content-Type':'application/json'},opts.headers||{}); if(this.t) h.Authorization=`Bearer ${this.t}`; const r=await fetch(API_URL+ep, Object.assign({},opts,{headers:h})); const d=await r.json().catch(()=>({})); if(!r.ok) throw new Error(d.message||d.error||('HTTP '+r.status)); return d; }
        async login(email, password){ const d=await this.req('/auth/login',{method:'POST',body:JSON.stringify({email,password})}); if(d.session){ this.t=d.session.access_token; this.r=d.session.refresh_token; try{localStorage.setItem('access_token',this.t);localStorage.setItem('refresh_token',this.r);}catch(_){}} return d; }
        async dashboard(){ return this.req('/employee/dashboard'); }
      }
      window.pwaApi = new Api();
    })();
  </script>
  <!-- POS Overlay -->
  <div id="pos-overlay" class="pos-overlay hidden">
    <div class="pos-header">
      <h1>üõí PlastiBorracha - Ponto de Venda</h1>
      <div class="pos-header-buttons">
        <button class="pos-settings-btn" id="pos-settings-btn">‚öôÔ∏è</button>
        <button class="pos-close-btn" id="pos-close-btn">‚úï</button>
      </div>
    </div>
    
    <!-- Mobile Cart Toggle -->
    <button class="pos-cart-toggle" id="pos-cart-toggle" style="display: none;">üõí</button>
    
    <div class="pos-body">
      <div class="pos-left">
        <!-- client selector area (below header, left of right bar) -->
        <div class="pos-client-panel">
          <button id="pos-choose-client" class="btn">Escolher Cliente</button>
          <div class="pos-client-info">
            <div class="pos-client-name">Consumidor final</div>
            <div class="pos-client-nif">NIF: 999999990</div>
          </div>
        </div>

        <!-- big invoice/articles area -->
        <div class="invoice-list" id="invoice-list">
          <!-- invoice rows will be injected here -->
          <div class="invoice-empty">Nenhum artigo adicionado</div>
        </div>
      </div>

      <aside class="pos-right">
        <div class="pos-total-card">
          <div class="pos-total-amount" id="pos-total-amount">‚Ç¨0,00</div>
          <div class="pos-total-label">Total da Fatura</div>
        </div>

        <button id="pos-pay-btn" class="pos-pay-btn">Pagar (F8)</button>

        <div class="pos-vendedor">
          <label class="pos-small-label">Vendedor</label>
          <select id="pos-vendedor-select">
            <option>Vendedor (F11)</option>
            <option>Jo√£o</option>
            <option>Maria</option>
          </select>
        </div>

        <div class="pos-right-actions">
          <button class="pos-action-btn">Visualizar (F12)</button>
          <button class="pos-action-btn">Vales Desconto</button>
          <button class="pos-action-btn">Intr. Quantidade</button>
          <button class="pos-action-btn">Novo Documento</button>
          <button class="pos-action-btn">Artigos (F2)</button>
          <button class="pos-action-btn">Mais Op√ß√µes</button>
          <button class="pos-action-btn btn-danger">Sair</button>
        </div>
      </aside>
    </div>

    <!-- Bottom entry area: choose which article to add -->
    <div class="pos-entry-bar" id="pos-entry-bar">
      <div class="pos-entry-top" style="display:flex;gap:10px;width:100%;align-items:center;">
        <div class="pos-entry-left">
          <label class="pos-small-label">Artigo</label>
          <input id="pos-entry-sku" class="pos-entry-input" placeholder="C√≥digo / Barra" />
        </div>

        <div class="pos-entry-mid" style="flex:1;">
          <label class="pos-small-label">Descri√ß√£o</label>
          <input id="pos-entry-desc" class="pos-entry-input" placeholder="Descri√ß√£o do artigo" />
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <div>
            <label class="pos-small-label">Qtd</label>
            <input id="pos-entry-qty" class="pos-entry-small" value="1" />
          </div>
          <div>
            <label class="pos-small-label">Pre√ßo</label>
            <input id="pos-entry-price" class="pos-entry-small" />
          </div>
          <div>
            <label class="pos-small-label">Desconto</label>
            <input id="pos-entry-discount" class="pos-entry-small" placeholder="%" />
          </div>
        </div>
      </div>

      <div class="pos-entry-actions" style="display:flex;gap:10px;margin-top:8px;">
        <button id="pos-entry-add" class="pos-entry-add">Adicionar</button>
        <button id="pos-entry-remove" class="btn btn-secondary">Remover</button>
        <button id="pos-entry-edit" class="btn">Alterar</button>
      </div>
    </div>
  </div>

  <!-- Brand delete confirmation modal (nested) -->
  <div id="brand-delete-confirm" class="nested-modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card" style="max-width:420px;margin:40px auto;padding:16px;">
      <header class="modal-header" style="display:flex;align-items:center;justify-content:space-between">
        <h3 style="margin:0;font-size:16px">Confirmar elimina√ß√£o</h3>
        <button id="brand-delete-confirm-close" class="icon-btn">‚úï</button>
      </header>
      <div class="modal-body" style="padding-top:12px">
        <p>Tem a certeza que pretende eliminar a marca <strong id="brand-delete-confirm-name">?</strong>?</p>
      </div>
      <div class="modal-actions" style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="brand-delete-confirm-cancel" class="btn">Cancelar</button>
        <button id="brand-delete-confirm-yes" class="btn-primary">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- Add Brand Modal (nested) -->
  <div id="add-brand-modal" class="nested-modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card" style="max-width:480px;margin:40px auto;padding:16px;">
      <header class="modal-header" style="display:flex;align-items:center;justify-content:space-between">
        <h3 style="margin:0;font-size:16px">Adicionar Marca</h3>
        <button id="add-brand-close" class="icon-btn">‚úï</button>
      </header>
      <div class="modal-body" style="padding-top:12px">
        <label style="display:block;font-weight:600;margin-bottom:8px">Nome</label>
        <input id="add-brand-name" type="text" placeholder="Nome da marca" style="width:100%;padding:10px;border:1px solid #e6eef8;border-radius:8px;margin-bottom:10px" />
      </div>
      <div class="modal-actions" style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="add-brand-cancel" class="btn">Cancelar</button>
        <button id="add-brand-save" class="btn-primary">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Add Model Modal (nested) -->
  <div id="add-model-modal" class="nested-modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card" style="max-width:520px;margin:40px auto;padding:16px;">
      <header class="modal-header" style="display:flex;align-items:center;justify-content:space-between">
        <h3 style="margin:0;font-size:16px">Adicionar Modelo</h3>
        <button id="add-model-close" class="icon-btn">‚úï</button>
      </header>
      <div class="modal-body" style="padding-top:12px">
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="flex:1;min-width:0">
            <label style="display:block;font-weight:600;margin-bottom:6px">Nome</label>
            <input id="add-model-name" type="text" placeholder="Nome do modelo" style="width:100%;padding:8px;border:1px solid #e6eef8;border-radius:6px;margin-bottom:8px" />
            <label style="display:block;font-weight:600;margin-bottom:6px">Descri√ß√£o</label>
            <textarea id="add-model-desc" rows="3" style="width:100%;padding:8px;border:1px solid #e6eef8;border-radius:6px;margin-bottom:8px"></textarea>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="add-model-file" type="file" accept="image/*" />
              <div style="color:#94a3b8;font-size:12px">Sem imagem</div>
            </div>
          </div>
          <div style="width:140px;text-align:center;flex-shrink:0">
            <div id="add-model-preview" style="width:140px;height:120px;border:1px solid #edf2f7;border-radius:8px;background-repeat:no-repeat;background-position:center;background-size:contain;display:flex;align-items:center;justify-content:center;color:#94a3b8">Sem imagem</div>
          </div>
        </div>
      </div>
      <div class="modal-actions" style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="add-model-cancel" class="btn">Cancelar</button>
        <button id="add-model-save" class="btn-primary">Guardar</button>
      </div>
    </div>
  </div>

  <!-- POS Settings Modal -->
  <div id="pos-settings-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <header class="modal-header">
        <h3>‚öôÔ∏è Defini√ß√µes POS</h3>
        <button id="close-pos-settings" class="icon-btn">‚úï</button>
      </header>
      
      <div class="modal-body">
        <div class="settings-section">
          <h4>üè™ Loja</h4>
          <label>Nome da Loja</label>
          <input id="pos-store-name" type="text" placeholder="PlastiBorracha" value="PlastiBorracha" />
          
          <label>Morada</label>
          <textarea id="pos-store-address" placeholder="Rua da Loja, 123&#10;1234-567 Cidade"></textarea>
        </div>
        
        <div class="settings-section">
          <h4>üí∞ Pre√ßos</h4>
          <label>
            <input id="pos-show-tax" type="checkbox" checked /> 
            Mostrar IVA separadamente
          </label>
          
          <label>Taxa IVA (%)</label>
          <input id="pos-tax-rate" type="number" value="23" min="0" max="100" step="0.1" />
        </div>
        
        <div class="settings-section">
          <h4>üßæ Recibos</h4>
          <label>
            <input id="pos-auto-print" type="checkbox" /> 
            Imprimir recibo automaticamente
          </label>
          
          <label>
            <input id="pos-show-barcode" type="checkbox" checked /> 
            Mostrar c√≥digo de barras nos produtos
          </label>
        </div>
        
        <div class="settings-section">
          <h4>üîß Sistema</h4>
          <label>
            <input id="pos-sound-enabled" type="checkbox" checked /> 
            Sons do sistema ativados
          </label>
          
          <label>Tema</label>
          <select id="pos-theme">
            <option value="light">Claro</option>
            <option value="dark">Escuro</option>
            <option value="auto">Autom√°tico</option>
          </select>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="pos-reset-settings" class="btn-secondary">Repor Padr√µes</button>
        <button id="pos-save-settings" class="btn-primary">Guardar</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" integrity="" crossorigin="anonymous" defer></script>
  <!-- Toast container + helper (global) -->
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
  <script>
    // global toast helper used by app.js
    window.showToast = function(message, type='info', opts={}){
      try{
        const container = document.getElementById('toast-container'); if(!container) return;
        const toast = document.createElement('div'); toast.className = 'toast-item toast-'+(type||'info');
        // allow newline -> <br>
        const html = (''+message).replace(/\n/g,'<br>');
        toast.innerHTML = html;
        // optional auto-dismiss timeout
        const timeout = (opts && opts.timeout!=null) ? opts.timeout : 4000;
        container.appendChild(toast);
        // enter animation
        requestAnimationFrame(()=>{ toast.classList.add('show'); });
        // remove after timeout
        if(timeout>0){ setTimeout(()=>{ toast.classList.remove('show'); setTimeout(()=>{ try{ container.removeChild(toast); }catch(_){} },300); }, timeout); }
        // allow click to dismiss
        toast.addEventListener('click', ()=>{ toast.classList.remove('show'); setTimeout(()=>{ try{ container.removeChild(toast); }catch(_){} },240); });
      }catch(e){ console.error('showToast error', e); }
    };
  </script>
  <script src="app.js?v=20251017" defer></script>
</body>
</html>
